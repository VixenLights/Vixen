(function(e){"function"===typeof require&&"object"===typeof exports&&"object"===typeof module?e(require("knockout"),exports):"function"===typeof define&&define.amd?define(["knockout","exports"],e):e(ko,ko.mapping={})})(function(e,f){function A(b,c){var a,d;for(d in c)if(c.hasOwnProperty(d)&&c[d])if(a=f.getType(b[d]),d&&b[d]&&"array"!==a&&"string"!==a)A(b[d],c[d]);else if("array"===f.getType(b[d])&&"array"===f.getType(c[d])){a=d;for(var e=b[d],l=c[d],p={},m=e.length-1;0<=m;--m)p[e[m]]=e[m];for(m=l.length-
1;0<=m;--m)p[l[m]]=l[m];e=[];l=void 0;for(l in p)e.push(p[l]);b[a]=e}else b[d]=c[d]}function G(b,c){var a={};A(a,b);A(a,c);return a}function C(b,c){for(var a=G({},b),e=M.length-1;0<=e;e--){var g=M[e];a[g]&&(a[""]instanceof Object||(a[""]={}),a[""][g]=a[g],delete a[g])}c&&(a.ignore=r(c.ignore,a.ignore),a.include=r(c.include,a.include),a.copy=r(c.copy,a.copy),a.observe=r(c.observe,a.observe));a.ignore=r(a.ignore,h.ignore);a.include=r(a.include,h.include);a.copy=r(a.copy,h.copy);a.observe=r(a.observe,
h.observe);a.mappedProperties=a.mappedProperties||{};a.copiedProperties=a.copiedProperties||{};return a}function r(b,c){"array"!==f.getType(b)&&(b="undefined"===f.getType(b)?[]:[b]);"array"!==f.getType(c)&&(c="undefined"===f.getType(c)?[]:[c]);return e.utils.arrayGetDistinctValues(b.concat(c))}function T(b,c){var a=e.dependentObservable;e.dependentObservable=function(a,c,d){d=d||{};a&&"object"==typeof a&&(d=a);var f=d.deferEvaluation,k=!1,D=function(a){var c=e.dependentObservable;e.dependentObservable=
v;var d=e.isWriteableObservable(a);e.dependentObservable=c;c=v({read:function(){k||(e.utils.arrayRemoveItem(b,a),k=!0);return a.apply(a,arguments)},write:d&&function(b){return a(b)},deferEvaluation:!0});c._wrapper=!0;c.__DO=a;return c};d.deferEvaluation=!0;a=new v(a,c,d);f||(a=D(a),b.push(a));return a};e.dependentObservable.fn=v.fn;e.computed=e.dependentObservable;var d=c();e.dependentObservable=a;e.computed=e.dependentObservable;return d}function H(b,c,a,d,g,l,p){var m="array"===f.getType(e.utils.unwrapObservable(c));
l=l||"";if(f.isMapped(b)){var k=e.utils.unwrapObservable(b).__ko_mapping__;a=G(k,a)}var D=p||g,h=function(){return a[d]&&a[d].create instanceof Function},r=function(b){return T(I,function(){return e.utils.unwrapObservable(g)instanceof Array?a[d].create({data:b||c,parent:D,skip:N}):a[d].create({data:b||c,parent:D})})},w=function(){return a[d]&&a[d].update instanceof Function},x=function(b,f){var g={data:f||c,parent:D,target:e.utils.unwrapObservable(b)};e.isWriteableObservable(b)&&(g.observable=b);
return a[d].update(g)};if(p=J.get(c))return p;d=d||"";if(m){var m=[],u=!1,n=function(a){return a};a[d]&&a[d].key&&(n=a[d].key,u=!0);e.isObservable(b)||(b=e.observableArray([]),b.mappedRemove=function(a){var c="function"==typeof a?a:function(b){return b===n(a)};return b.remove(function(a){return c(n(a))})},b.mappedRemoveAll=function(a){var c=E(a,n);return b.remove(function(a){return-1!=e.utils.arrayIndexOf(c,n(a))})},b.mappedDestroy=function(a){var c="function"==typeof a?a:function(b){return b===n(a)};
return b.destroy(function(a){return c(n(a))})},b.mappedDestroyAll=function(a){var c=E(a,n);return b.destroy(function(a){return-1!=e.utils.arrayIndexOf(c,n(a))})},b.mappedIndexOf=function(a){var c=E(b(),n);a=n(a);return e.utils.arrayIndexOf(c,a)},b.mappedGet=function(a){return b()[b.mappedIndexOf(a)]},b.mappedCreate=function(a){if(-1!==b.mappedIndexOf(a))throw Error("There already is an object with the key that you specified.");var c=h()?r(a):a;w()&&(a=x(c,a),e.isWriteableObservable(c)?c(a):c=a);b.push(c);
return c});p=E(e.utils.unwrapObservable(b),n).sort();k=E(c,n);u&&k.sort();u=e.utils.compareArrays(p,k);p={};var v,B=e.utils.unwrapObservable(c),z={},A=!0,k=0;for(v=B.length;k<v;k++){var t=n(B[k]);if(void 0===t||t instanceof Object){A=!1;break}z[t]=B[k]}var B=[],C=0,k=0;for(v=u.length;k<v;k++){var t=u[k],q,y=l+"["+k+"]";switch(t.status){case "added":var F=A?z[t.value]:K(e.utils.unwrapObservable(c),t.value,n);q=H(void 0,F,a,d,b,y,g);h()||(q=e.utils.unwrapObservable(q));y=O(e.utils.unwrapObservable(c),
F,p);q===N?C++:B[y-C]=q;p[y]=!0;break;case "retained":F=A?z[t.value]:K(e.utils.unwrapObservable(c),t.value,n);q=K(b,t.value,n);H(q,F,a,d,b,y,g);y=O(e.utils.unwrapObservable(c),F,p);B[y]=q;p[y]=!0;break;case "deleted":q=K(b,t.value,n)}m.push({event:t.status,item:q})}b(B);a[d]&&a[d].arrayChanged&&e.utils.arrayForEach(m,function(b){a[d].arrayChanged(b.event,b.item)})}else if(P(c)){b=e.utils.unwrapObservable(b);if(!b){if(h())return u=r(),w()&&(u=x(u)),u;if(w())return x(u);b={}}w()&&(b=x(b));J.save(c,
b);if(w())return b;Q(c,function(d){var f=l.length?l+"."+d:d;if(-1==e.utils.arrayIndexOf(a.ignore,f))if(-1!=e.utils.arrayIndexOf(a.copy,f))b[d]=c[d];else if("object"!=typeof c[d]&&"array"!=typeof c[d]&&0<a.observe.length&&-1==e.utils.arrayIndexOf(a.observe,f))b[d]=c[d],a.copiedProperties[f]=!0;else{var g=J.get(c[d]),p=H(b[d],c[d],a,d,b,f,b),g=g||p;if(0<a.observe.length&&-1==e.utils.arrayIndexOf(a.observe,f))b[d]=g(),a.copiedProperties[f]=!0;else{if(e.isWriteableObservable(b[d])){if(g=e.utils.unwrapObservable(g),
b[d]()!==g)b[d](g)}else g=void 0===b[d]?g:e.utils.unwrapObservable(g),b[d]=g;a.mappedProperties[f]=!0}}})}else switch(f.getType(c)){case "function":w()?e.isWriteableObservable(c)?(c(x(c)),b=c):b=x(c):b=c;break;default:if(e.isWriteableObservable(b))return q=w()?x(b):e.utils.unwrapObservable(c),b(q),q;h()||w();b=h()?r():e.observable(e.utils.unwrapObservable(c));w()&&b(x(b))}return b}function O(b,c,a){for(var d=0,e=b.length;d<e;d++)if(!0!==a[d]&&b[d]===c)return d;return null}function R(b,c){var a;c&&
(a=c(b));"undefined"===f.getType(a)&&(a=b);return e.utils.unwrapObservable(a)}function K(b,c,a){b=e.utils.unwrapObservable(b);for(var d=0,f=b.length;d<f;d++){var l=b[d];if(R(l,a)===c)return l}throw Error("When calling ko.update*, the key '"+c+"' was not found!");}function E(b,c){return e.utils.arrayMap(e.utils.unwrapObservable(b),function(a){return c?R(a,c):a})}function Q(b,c){if("array"===f.getType(b))for(var a=0;a<b.length;a++)c(a);else for(a in b)c(a)}function P(b){var c=f.getType(b);return("object"===
c||"array"===c)&&null!==b}function U(){var b=[],c=[];this.save=function(a,d){var f=e.utils.arrayIndexOf(b,a);0<=f?c[f]=d:(b.push(a),c.push(d))};this.get=function(a){a=e.utils.arrayIndexOf(b,a);return 0<=a?c[a]:void 0}}function S(){var b={},c=function(a){var c;try{c=a}catch(e){c="$$$"}a=b[c];void 0===a&&(a=new U,b[c]=a);return a};this.save=function(a,b){c(a).save(a,b)};this.get=function(a){return c(a).get(a)}}var v=e.dependentObservable,L=0,I,J,M=["create","update","key","arrayChanged"],N={},z={include:["_destroy"],
ignore:[],copy:[],observe:[]},h=z;f.isMapped=function(b){return(b=e.utils.unwrapObservable(b))&&b.__ko_mapping__};f.fromJS=function(b){if(0==arguments.length)throw Error("When calling ko.fromJS, pass the object you want to convert.");try{L++||(I=[],J=new S);var c,a;2==arguments.length&&(arguments[1].__ko_mapping__?a=arguments[1]:c=arguments[1]);3==arguments.length&&(c=arguments[1],a=arguments[2]);a&&(c=G(c,a.__ko_mapping__));c=C(c);var d=H(a,b,c);a&&(d=a);if(!--L)for(;I.length;){var e=I.pop();e&&
(e(),e.__DO.throttleEvaluation=e.throttleEvaluation)}d.__ko_mapping__=G(d.__ko_mapping__,c);return d}catch(f){throw L=0,f;}};f.fromJSON=function(b){var c=e.utils.parseJson(b);arguments[0]=c;return f.fromJS.apply(this,arguments)};f.updateFromJS=function(b){throw Error("ko.mapping.updateFromJS, use ko.mapping.fromJS instead. Please note that the order of parameters is different!");};f.updateFromJSON=function(b){throw Error("ko.mapping.updateFromJSON, use ko.mapping.fromJSON instead. Please note that the order of parameters is different!");
};f.toJS=function(b,c){h||f.resetDefaultOptions();if(0==arguments.length)throw Error("When calling ko.mapping.toJS, pass the object you want to convert.");if("array"!==f.getType(h.ignore))throw Error("ko.mapping.defaultOptions().ignore should be an array.");if("array"!==f.getType(h.include))throw Error("ko.mapping.defaultOptions().include should be an array.");if("array"!==f.getType(h.copy))throw Error("ko.mapping.defaultOptions().copy should be an array.");c=C(c,b.__ko_mapping__);return f.visitModel(b,
function(a){return e.utils.unwrapObservable(a)},c)};f.toJSON=function(b,c){var a=f.toJS(b,c);return e.utils.stringifyJson(a)};f.defaultOptions=function(){if(0<arguments.length)h=arguments[0];else return h};f.resetDefaultOptions=function(){h={include:z.include.slice(0),ignore:z.ignore.slice(0),copy:z.copy.slice(0)}};f.getType=function(b){if(b&&"object"===typeof b){if(b.constructor===Date)return"date";if("[object Array]"===Object.prototype.toString.call(b))return"array"}return typeof b};f.visitModel=
function(b,c,a){a=a||{};a.visitedObjects=a.visitedObjects||new S;var d,g=e.utils.unwrapObservable(b);if(P(g))a=C(a,g.__ko_mapping__),c(b,a.parentName),d="array"===f.getType(g)?[]:{};else return c(b,a.parentName);a.visitedObjects.save(b,d);var l=a.parentName;Q(g,function(b){if(!a.ignore||-1==e.utils.arrayIndexOf(a.ignore,b)){var m=g[b],k=a,h=l||"";"array"===f.getType(g)?l&&(h+="["+b+"]"):(l&&(h+="."),h+=b);k.parentName=h;if(-1!==e.utils.arrayIndexOf(a.copy,b)||-1!==e.utils.arrayIndexOf(a.include,b)||
!g.__ko_mapping__||!g.__ko_mapping__.mappedProperties||g.__ko_mapping__.mappedProperties[b]||!g.__ko_mapping__.copiedProperties||g.__ko_mapping__.copiedProperties[b]||"array"===f.getType(g))switch(f.getType(e.utils.unwrapObservable(m))){case "object":case "array":case "undefined":k=a.visitedObjects.get(m);d[b]="undefined"!==f.getType(k)?k:f.visitModel(m,c,a);break;default:d[b]=c(m,a.parentName)}}});return d}});